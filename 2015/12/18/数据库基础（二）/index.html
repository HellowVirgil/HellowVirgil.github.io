<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 数据库基础（二） · VirgilZone</title><meta name="description" content="数据库基础（二） - Virgil"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://hellowvirgil.github.io/atom.xml" title="VirgilZone"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/HellowVirgil" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://weibo.com/u/3074324883" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="http://www.zhihu.com/people/callmevirgil" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">数据库基础（二）</h1><div class="post-info">Dec 18, 2015</div><div class="post-content"><h2 id="一、CHAR_和_VARCHAR_的存储编码">一、CHAR 和 VARCHAR 的存储编码</h2><p>默认单位是字节，可指定为字符</p>
<pre><code>- <span class="keyword">CHAR</span>（<span class="number">10</span>），等价于 <span class="keyword">CHAR</span>（<span class="number">10</span> <span class="keyword">byte</span>）
</code></pre><p>每个英文字符占用一个字节，每个中文按编码不同，占用2-4个字节</p>
<pre><code>- GBK 占用<span class="number">2</span>个字节
- utf-<span class="number">8</span> 占用<span class="number">3</span>个字节
</code></pre><a id="more"></a>
<h2 id="二、CHAR_和_VARCHAR_的最大长度">二、CHAR 和 VARCHAR 的最大长度</h2><p>CHAR 默认长度为1，即  name CHAR 相当于 name CHAR（1），但 VARCHAR 长度不可省略</p>
<h2 id="三、LONG_和_CLOB_类型">三、LONG 和 CLOB 类型</h2><p>LONG—VARCHAR的加长版，存储变长字符串，最多到达2GB的字符串数据</p>
<p>LONG有诸多存储限制:每个表只能有一个LONG类型列；不能作为主键；不能建立索引；不能出现在查询条件中…<br>CLOB：存储定长或变长字符串，最多达4GB的字符串数据</p>
<pre><code><span class="bullet">- </span>ORACLE 建议开发中使用 CLOB 替代 LONG 类型
</code></pre><h2 id="四、字符串函数">四、字符串函数</h2><p><strong><em>CONCAT 拼接字符串</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">CONCAT</span>(<span class="keyword">name</span>,<span class="string">':'</span>), age) <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p>使用『||』也可以连接字符串，通常使用它来代替 CONCAT 函数<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span>||<span class="string">':'</span>|| age <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>LENGTH 用于返回字符串长度（字符量)</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span>,<span class="keyword">LENGTH</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>UPPER，LOWER 将字符转换为大写或小写</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOWER</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>INITCAP 将首字母转换为大写（其中可以使用空格分隔多个单词，那么每个单词首字母都会大写）,其他字母转换为小写</em></strong><br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> INITCAP(<span class="built_in">name</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure></p>
<p><strong><em>DUAL 伪表</em></strong><br>为了满足 SELECT 语法要求使用，当我们查询的数据不来自任何一张表时，可以使用伪表代替 FROM 字句中的内容伪表仅会查询出一条记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(‘hello<span class="string">') FROM DUAL</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>TRIM 去除当前字符串中两边重复的给定字符,截取集只能有一个字符</em></strong><br><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'e'</span> <span class="keyword">FROM</span> <span class="string">'eeeehelloeeeee'</span>) <span class="keyword">FROM</span> DUAL     <span class="comment">//a</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>LTRIM，RTRIM 单独去除字符串中左边重复或右边的给定字符，截取集可以有多个字符，会把截取集中的每个字符都去除</em></strong><br><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LTRIM</span>(<span class="string">'esweeehelloeeewsee'</span>,<span class="string">'esw'</span>) <span class="keyword">FROM</span> DUAL;     <span class="comment">//helloeeewsee</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(<span class="string">'esweeehelloeeewsee'</span>,<span class="string">'esw'</span>) <span class="keyword">FROM</span> DUAL;     <span class="comment">//esweeehello</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>LPAD，RPAD 补位函数</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="keyword">name</span>,<span class="number">3</span>,<span class="string">'$'</span>) <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p>如果比原来小则会进行截取<br>通过 LPAD ， RPAD 可以实现左右对齐效果</p>
<p><strong><em>SUBSTR（char，offset，len） 从给定字符串的给定位置开始，连续向后截取len长度的字符串(字符位置从1开始)</em></strong><br>offset可正可负，若是负数，则从倒数字符开始截取<br>len必须是&gt;=0的数字，若截取的字符数量超过实际可以截取的字符数量时，则截取到字符串末尾<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTR（<span class="string">'HelloWorld'</span>,<span class="number">5</span>,<span class="number">2</span>）     <span class="comment">//oW</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR（<span class="string">'HelloWorld'</span>,-<span class="number">3</span>,<span class="number">2</span>）     <span class="comment">//rl</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>INSTR(char1,char2[,n,m]) 查看char2在char1中的位置</em></strong><br>n:从char1的第几个字符开始查找（不写则为1）<br>m:查找第几次出现（不写则为1）<br>没有返回0<br><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSTR</span> （<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">4</span>,<span class="number">2</span>）<span class="comment">//9</span></span><br></pre></td></tr></table></figure></p>
<h2 id="五、数值函数">五、数值函数</h2><p><strong><em>ROUND（n[,m]）：用于四舍五入</em></strong><br>参数中的n可以是任何数字，指要被处理的数字</p>
<ul>
<li>m 必须是整数</li>
<li>m 取正数则四舍五入到小数点后第m位</li>
<li>m 取0值则四舍五入到整数位</li>
<li>m 取负数，则四舍五入到小数点前m位</li>
<li>m 缺省，默认值是0</li>
</ul>
<figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>（<span class="number">45.678</span>,<span class="number">2</span>） <span class="keyword">FROM</span> dual     <span class="comment">//45.68</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>（<span class="number">45.678</span>,-<span class="number">1</span>） <span class="keyword">FROM</span> dual     <span class="comment">//50</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>（<span class="number">95.678</span>,-<span class="number">2</span>） <span class="keyword">FROM</span> dual     <span class="comment">//100</span></span><br></pre></td></tr></table></figure>
<p><strong><em>TRUNC 与 ROUND 的参数相同，但区别在于，仅保留指定位数，不做四舍五入操作</em></strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT TRUNC（<span class="number">45.678</span>,<span class="number">2</span>） FROM dual     <span class="comment">//45.67</span></span><br><span class="line">SELECT TRUNC（<span class="number">45.678</span>,-<span class="number">1</span>） FROM dual     <span class="comment">//40</span></span><br><span class="line">SELECT TRUNC（<span class="number">95.678</span>,-<span class="number">2</span>） FROM dual     <span class="comment">//0</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>MOD（m，n）模运算，取余</em></strong></p>
<ul>
<li>m 被除数</li>
<li>n 除数</li>
</ul>
<p>若n为0，则直接返回m<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span>,<span class="keyword">MOD</span>(<span class="keyword">id</span>,<span class="number">1000</span>) <span class="keyword">from</span> student</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>CEIL 和 FLOOR 向上取整和向下取整</em></strong><br><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">4.5</span>) <span class="keyword">FROM</span> dual     <span class="comment">//5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">4.5</span>) <span class="keyword">FROM</span> dual     <span class="comment">//4</span></span><br></pre></td></tr></table></figure></p>
<h2 id="六、日期转换函数">六、日期转换函数</h2><p><strong><em>SYSDATE 返回一个DATE类型的当前系统时间，精确到秒，默认显示格式是DD-MON-RR</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student hiredate <span class="keyword">VALUES</span> <span class="keyword">SYSDATE</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>SYSTIMESTAMP 返回一个TIMESTAMP类型的当前系统时间，精确到毫秒</em></strong></p>
<p><strong><em>TO_DATE 字符串转时间</em></strong><br>日期类型的数据室可以进行计算的，两个日期类型的值相减，得到的差是相差的天数。给一个日期的值加上一个数字，相当于增加了x天。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> TRUNC((<span class="keyword">SYSDATE</span> - <span class="keyword">TO_DATE</span>(<span class="string">'1994-11-08'</span>,<span class="string">'YYYY-MM-DD'</span>))) <span class="keyword">FROM</span> DUAL</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>TO_CHAR 可以将给定的DATE按照特定的日期格式转化为字符串</em></strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="function"><span class="title">TO_CHAR</span><span class="params">(TO_DATE(<span class="string">'98-05-30'</span>,<span class="string">'RR_MM_DD'</span>)</span></span>,<span class="string">'YYYY-MM-DD'</span>) FROM DUAL     <span class="comment">//1998-05-30</span></span><br><span class="line">SELECT <span class="function"><span class="title">TO_CHAR</span><span class="params">(SYSDATE,<span class="string">'YYYY"年"MM"月"DD"日"'</span>)</span></span> FROM DUAL    <span class="comment">//2015年12月17日</span></span><br></pre></td></tr></table></figure></p>
<h2 id="七、日期常用函数">七、日期常用函数</h2><p><strong><em>LAST_DAY 返回日期date所在月的最后一天</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">LAST_DAY</span>(<span class="string">'20-2月-09'</span>) <span class="keyword">FROM</span> DUAL</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>ADD_MONTHS（date，i） 返回日期date加上i个月后的日期值</em></strong></p>
<ul>
<li>参数i可以是任何数字，大部分的时候去正值整数</li>
<li>如果i是小数，将会被截取整数后再参与运算</li>
<li>如果i是负数，则获得的是减去i个月后的日期值</li>
</ul>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> <span class="built_in">name</span>，ADD_MONTHS（hiredate，<span class="number">20</span>*<span class="number">12</span>） <span class="keyword">FROM</span> student</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p><strong><em>MONTHS_BETWEEN（date1，date2） 计算date1和date2两个日期之间间隔了多少个月</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span>,MONTHS_BETWEEN（<span class="keyword">SYSDATE</span>,hiredate） <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>NEXT_DAY（date，char） 返回date日期数据的下一个周几，周几是由参数char来决定的</em></strong><br>char可以用数字表示，1-7表示周日到周六<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> NEXT_DAY(SYSDATE,<span class="number">4</span>) <span class="keyword">as</span>  <span class="string">'NEXT_WEDN'</span> <span class="keyword">FROM</span> DUAL     <span class="comment">//下周三的日期</span></span><br></pre></td></tr></table></figure></p>
<p><em>*</em>LEAST，GREATEST 返回结果是参数中最大或最小的值在比较之前，参数列表中第二个以后的参数类型会被转成第<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">LEAST</span>（<span class="keyword">SYSDATE</span>,<span class="keyword">TO_DATE</span>(<span class="string">'2008-10-10'</span>,<span class="string">'YYYY-MM-DD'</span>)） <span class="keyword">FROM</span> DUAL</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>EXTRACT（date FROM datetime） 从参数datetime中提取参数date指定的数据，比如提取年、月、日</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span>,hiredate <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">EXTRACT</span>（<span class="keyword">YEAR</span> <span class="keyword">FROM</span> hiredate）= <span class="number">1981</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="八、空值操作">八、空值操作</h2><p><strong><em>判断一个字段的值是否为NULL时，不能使用『=』判断，而是使用 IS NULL 或 IS NOT NULL</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> gender=<span class="string">'M'</span> <span class="keyword">WHERE</span> gender <span class="keyword">IS</span> <span class="literal">NULL</span></span></span><br></pre></td></tr></table></figure></p>
<p>NULL与字符串链接，等于什么都没干<br>NULL与数字运算，结果还是NULL</p>
<p><strong><em>NVL（expr1，expr2）将NULL转变为非NULL值,若expr1为NULL，则函数返回expr2，否则就返回expr1的值</em></strong><br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> <span class="built_in">name</span>,NVL(comm,<span class="number">0</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure></p>
<p><strong><em>NVL2（expr1,expr2,expr3）和NVL类似，用来判断expr1是否为NULL，如果不为NULL，则返回expr2，如果为NULL，则返回expr3</em></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">name</span> ,NVL2(comm,’有奖金’,<span class="string">'没有奖金'</span>) <span class="keyword">FROM</span> student</span></span><br></pre></td></tr></table></figure></p>
<p>NVL2能实现NVL的功能，但NVL不能实现NVL2的全部功能</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/12/19/数据库基础（三）/" class="prev">上一篇</a><a href="/2015/12/17/数据库基础（一）/" class="next">下一篇</a></div><div data-thread-key="2015/12/18/数据库基础（二）/" data-title="数据库基础（二）" data-url="http://hellowvirgil.github.io/2015/12/18/数据库基础（二）/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"true"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 <a href="http://hellowvirgil.github.io">Virgil</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>